<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="MZK ELITE">
<link rel="apple-touch-icon" href="mzk_banner.png">
<title>MZK RPG - ELITE SYSTEM</title>

<style>
:root {
    --primary: #ff2b2b;
    --bg: #0a0a0a;
    --card-bg: linear-gradient(145deg, #1a0000, #250000);
    --gold: #ffd700;
    --coin: #ff9900;
    --blue: #0088ff;
}
* { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
body {
    margin: 0;
    padding: env(safe-area-inset-top) 15px 40px 15px;
    background: var(--bg);
    color: #fff;
    font-family: -apple-system, system-ui, sans-serif;
    overflow-x: hidden;
}
#app { max-width: 500px; margin: 0 auto; position: relative; }
canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 999; }

.banner-img { width: 100%; border-radius: 15px; border: 1px solid var(--primary); margin: 15px 0; box-shadow: 0 0 15px rgba(255,0,0,0.3); }

.top-bar { display: flex; justify-content: space-between; margin-bottom: 10px; font-weight: bold; font-size: 0.75rem; }
.coin-display { color: var(--coin); display: flex; align-items: center; gap: 5px; }

.level-card { background: var(--card-bg); border-radius: 12px; padding: 20px; text-align: center; border: 1px solid #330000; margin-bottom: 15px; transition: 0.3s; }
.xp-label { font-size: 1.6rem; font-weight: 900; color: var(--primary); text-shadow: 0 0 10px rgba(255,0,0,0.4); }

h2 { font-size: 0.85rem; color: var(--primary); text-transform: uppercase; margin: 25px 0 10px; border-left: 3px solid var(--primary); padding-left: 10px; }
.card { background: var(--card-bg); padding: 15px; border-radius: 12px; border: 1px solid #330000; margin-bottom: 12px; }

.grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
button { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: 800; cursor: pointer; font-size: 0.75rem; transition: 0.2s; }
button:active { transform: scale(0.95); background: #b00; }
button:disabled { background: #222; color: #555; }

.shop-item { background: rgba(0,0,0,0.3); padding: 12px; border-radius: 8px; text-align: center; border: 1px solid #444; }
.inventory-slot { display: inline-block; padding: 6px 12px; background: #222; border: 1px solid var(--gold); border-radius: 4px; margin: 4px; font-size: 0.65rem; color: var(--gold); }

.bar-bg { background: #1a0000; height: 12px; border-radius: 6px; margin-top: 8px; overflow: hidden; border: 1px solid #300; }
.bar-fill { height: 100%; background: var(--primary); width: 0%; transition: 0.6s cubic-bezier(0.22, 1, 0.36, 1); }

.history-item { font-size: 0.65rem; color: #888; padding: 6px 0; border-bottom: 1px solid #1a1a1a; }
.chat-msg { color: var(--gold); font-style: italic; font-weight: bold; }

.rank-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
.rank-table td { padding: 10px 5px; border-bottom: 1px solid #1a1a1a; }
.player-row { background: rgba(255, 43, 43, 0.2); font-weight: bold; color: var(--primary); }

@keyframes lvlUp { 0% {transform: scale(1);} 50% {transform: scale(1.1); box-shadow: 0 0 30px var(--gold);} 100% {transform: scale(1);} }
.lvl-anim { animation: lvlUp 0.6s ease; }
</style>
</head>
<body onclick="initAudio()">

<canvas id="confetti"></canvas>

<div id="app">
    <img src="mzk_banner.png" alt="MZK LOGO" class="banner-img">

    <div class="top-bar">
        <div id="rankBadge">PATENTE: BRONZE</div>
        <div class="coin-display">üí∞ <span id="coinsVal">0</span> MZK COINS</div>
    </div>

    <div class="level-card" id="mainCard">
        <div class="xp-label" id="levelTxt">LVL 1</div>
        <div class="bar-bg"><div id="xpBarFill" class="bar-fill"></div></div>
        <div id="xpStatus" style="font-size: 0.6rem; margin-top: 8px; color: var(--gold); display: none;">‚ö° BUFF: XP EM DOBRO ATIVO!</div>
    </div>

    <h2>üõí Mercado & Invent√°rio</h2>
    <div class="card">
        <div class="grid">
            <div class="shop-item">
                <p>‚ö° XP Dobro (1h)<br><b style="color:var(--coin)">150 c</b></p>
                <button onclick="buyItem('doubleXp', 150)">COMPRAR</button>
            </div>
            <div class="shop-item">
                <p>üçî Fast Food<br><b style="color:var(--coin)">500 c</b></p>
                <button onclick="buyItem('fastFood', 500)">COMPRAR</button>
            </div>
        </div>
        <div id="inventoryList" style="margin-top: 10px;"></div>
    </div>

    <h2>üèãÔ∏è Treino do Dia</h2>
    <div class="card">
        <select id="gymType" style="width:100%; background:#000; color:#fff; border:1px solid var(--primary); padding:12px; border-radius:8px; margin-bottom:12px;">
            <option value="Peito">Peito & Tr√≠ceps</option>
            <option value="Costas">Costas & B√≠ceps</option>
            <option value="Pernas">Pernas (Hardcore)</option>
            <option value="Boxe">ü•ä Sparring de Boxe</option>
        </select>
        <button id="gymBtn" onclick="completeGym()">FINALIZAR TREINO</button>
    </div>

    <h2>üåç Ranking Global</h2>
    <div class="card">
        <table class="rank-table">
            <tbody id="rankingTable"></tbody>
        </table>
    </div>

    <h2>üìÖ Miss√µes</h2>
    <div class="card">
        <div class="grid" id="dailyTasks"></div>
    </div>

    <div class="card">
        <h3>üíß √Ågua (3L) <span id="waterVal" style="float:right">0ml</span></h3>
        <div class="grid" style="grid-template-columns: 1fr 1fr 1fr;">
            <button onclick="addWater(250)">+250</button>
            <button onclick="addWater(500)">+500</button>
            <button onclick="addWater(1000)">+1L</button>
        </div>
        <div class="bar-bg"><div id="waterBarFill" class="bar-fill" style="background:var(--blue)"></div></div>
    </div>

    <h2>üèÜ Hall da Fama</h2>
    <div class="card" id="medalsList" style="display:flex; flex-wrap:wrap; gap:5px; justify-content:center;"></div>

    <h2>üìú Log de Atividades</h2>
    <div class="card" id="historyLog"></div>
</div>

<script>
let audioCtx = null;
let state = {
    xp: 0, lvl: 1, coins: 0, water: 0, 
    tasks: { gym: false, meals: {} },
    inventory: [], doubleXpActive: false,
    history: [], medals: [], date: new Date().toLocaleDateString()
};

let rivals = [
    { name: "Pedrin MDM", lvl: 12, xp: 50 },
    { name: "Cosmin", lvl: 10, xp: 20 },
    { name: "Vitinn", lvl: 8, xp: 70 },
    { name: "MtO", lvl: 6, xp: 40 }
];

const trashTalk = {
    PedrinMDM: ["O topo √© meu, aceita.", "Treinei enquanto voc√™ dormia.", "XP lento demais, MZK."],
    Cosmin: ["Cuidado no retrovisor!", "A meta de hoje j√° foi."],
    Vitinn: ["Bebeu √°gua ou t√° esperando o Boss?", "T√¥ focado."]
};

function initAudio() { if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }

function playSound(f, t='sine', d=0.1) {
    if(!audioCtx) return;
    const o=audioCtx.createOscillator(); const g=audioCtx.createGain();
    o.connect(g); g.connect(audioCtx.destination);
    o.type=t; o.frequency.value=f; g.gain.value=0.05;
    o.start(); o.stop(audioCtx.currentTime+d);
}

function createConfetti() {
    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    let p = Array.from({length:50}, () => ({x:Math.random()*canvas.width, y:canvas.height, v:Math.random()*5+2, c:`hsl(${Math.random()*360},100%,50%)`}));
    function draw() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        p.forEach(p => { p.y -= p.v; ctx.fillStyle=p.c; ctx.fillRect(p.x, p.y, 5, 5); });
        if(p[0].y > -10) requestAnimationFrame(draw);
    }
    draw();
}

function addXP(amount, reason) {
    let finalXP = state.doubleXpActive ? amount * 2 : amount;
    state.xp += finalXP;
    state.coins += 15;
    addHistory(`+${finalXP} XP | +15c : ${reason}`);
    
    if(state.xp >= 100) { 
        state.lvl++; state.xp = 0; 
        document.getElementById('mainCard').classList.add('lvl-anim');
        setTimeout(()=>document.getElementById('mainCard').classList.remove('lvl-anim'), 600);
        createConfetti(); playSound(523, 'square');
    }
    checkMedals(); save(); render();
}

function addHistory(text, isChat = false) {
    const time = new Date().toLocaleTimeString().slice(0,5);
    state.history.unshift(`<span class="${isChat ? 'chat-msg' : ''}">${time} - ${text}</span>`);
    if(state.history.length > 6) state.history.pop();
}

function buyItem(item, cost) {
    if(state.coins >= cost) {
        state.coins -= cost;
        if(item === 'doubleXp') {
            state.doubleXpActive = true;
            addHistory("‚ö° BUFF ATIVADO: 1h de XP Dobrado!");
            setTimeout(() => { state.doubleXpActive = false; render(); }, 3600000);
        } else {
            state.inventory.push(item === 'fastFood' ? 'üçî Fast Food' : 'üíé Item');
        }
        save(); render();
    } else alert("Coins insuficientes!");
}

function updateRivals() {
    rivals.forEach(r => {
        r.xp += Math.floor(Math.random() * 20);
        if(r.xp >= 100) {
            r.lvl++; r.xp = 0;
            if(r.lvl >= state.lvl) {
                const key = r.name.replace(" ", "");
                const msg = trashTalk[key] ? trashTalk[key][Math.floor(Math.random()*trashTalk[key].length)] : "Subi de n√≠vel!";
                addHistory(`${r.name.toUpperCase()}: "${msg}"`, true);
            }
        }
    });
    renderRanking();
}

function completeGym() {
    if(!state.tasks.gym) {
        state.tasks.gym = true;
        addXP(50, `Treino de ${document.getElementById('gymType').value}`);
    }
}

function addWater(v) {
    state.water = Math.min(state.water + v, 3000);
    addXP(5, "√Ågua");
}

function toggleMeal(m) {
    if(!state.tasks.meals[m]) {
        state.tasks.meals[m] = true;
        addXP(15, `Refei√ß√£o: ${m}`);
    }
}

function checkMedals() {
    const m = state.medals;
    if(state.water >= 3000 && !m.includes("H2O")) m.push("H2O");
    if(state.tasks.gym && !m.includes("BEAST")) m.push("BEAST");
    if(state.lvl >= 10 && !m.includes("TOP")) m.push("TOP");
}

function save() { localStorage.setItem('mzk_final_v1', JSON.stringify(state)); }

function load() {
    const saved = localStorage.getItem('mzk_final_v1');
    if(saved) {
        const parsed = JSON.parse(saved);
        if(parsed.date !== new Date().toLocaleDateString()) {
            state = {...parsed, water:0, tasks:{gym:false, meals:{}}, date:new Date().toLocaleDateString()};
        } else state = parsed;
    }
    render();
}

function renderRanking() {
    let lb = [...rivals, { name: "VOC√ä", lvl: state.lvl, xp: state.xp, isPlayer: true }];
    lb.sort((a,b) => b.lvl !== a.lvl ? b.lvl - a.lvl : b.xp - a.xp);
    document.getElementById('rankingTable').innerHTML = lb.map((p,i) => `
        <tr class="${p.isPlayer ? 'player-row' : ''}">
            <td>${i+1}¬∫</td><td>${p.isPlayer ? 'üëë ' : ''}${p.name}</td><td style="text-align:right">LVL ${p.lvl}</td>
        </tr>
    `).join('');
}

function render() {
    document.getElementById('levelTxt').innerText = `LVL ${state.lvl}`;
    document.getElementById('xpBarFill').style.width = `${state.xp}%`;
    document.getElementById('coinsVal').innerText = state.coins;
    document.getElementById('waterVal').innerText = `${state.water}/3000ml`;
    document.getElementById('waterBarFill').style.width = `${(state.water/3000)*100}%`;
    document.getElementById('xpStatus').style.display = state.doubleXpActive ? 'block' : 'none';
    
    const r = [{l:100,n:"IMORTAL"},{l:50,n:"PLATINA"},{l:25,n:"OURO"},{l:10,n:"PRATA"},{l:1,n:"BRONZE"}].find(x => state.lvl >= x.l);
    document.getElementById('rankBadge').innerText = `PATENTE: ${r.n}`;

    document.getElementById('inventoryList').innerHTML = state.inventory.map(i => `<span class="inventory-slot">${i}</span>`).join('');
    
    const meals = ["Caf√©", "Almo√ßo", "Lanche", "Jantar"];
    document.getElementById('dailyTasks').innerHTML = meals.map(m => `
        <button onclick="toggleMeal('${m}')" ${state.tasks.meals[m] ? 'disabled' : ''}>${state.tasks.meals[m] ? m+' ‚úî' : m}</button>
    `).join('');

    document.getElementById('historyLog').innerHTML = state.history.map(h => `<div class="history-item">${h}</div>`).join('');

    const medalData = { "H2O": "üíß Hidratado", "BEAST": "üëπ Beast", "TOP": "üèÜ Elite" };
    document.getElementById('medalsList').innerHTML = state.medals.map(m => `
        <div style="background:var(--gold); color:#000; padding:5px 10px; border-radius:4px; font-size:0.6rem; font-weight:bold;">${medalData[m] || m}</div>
    `).join('');

    document.getElementById('gymBtn').disabled = state.tasks.gym;
    renderRanking();
}

window.onload = load;
setInterval(updateRivals, 30000);
</script>
</body>
</html>